#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –Ω–∞ Reg.ru
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./scripts/deploy_regru.sh [domain]

DOMAIN=${1:-"yourdomain.ru"}
BUILD_DIR="build/web"
TEMP_DIR="temp_deploy"

echo "üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ Photo App –Ω–∞ Reg.ru"
echo "üåê –î–æ–º–µ–Ω: $DOMAIN"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Å–±–æ—Ä–∫–∏
if [ ! -d "$BUILD_DIR" ]; then
    echo "‚ùå –ü–∞–ø–∫–∞ $BUILD_DIR –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–±–æ—Ä–∫—É:"
    echo "   ./build_web.sh"
    exit 1
fi

# –°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –ø–∞–ø–∫–∏
echo "üìÅ –°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –ø–∞–ø–∫–∏ –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è..."
rm -rf $TEMP_DIR
mkdir -p $TEMP_DIR

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
echo "üìã –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤..."
cp -r $BUILD_DIR/* $TEMP_DIR/

# –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
echo "üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏..."
cd $TEMP_DIR
zip -r "../photo_app_deploy.zip" . -x "*.DS_Store" "*.git*"
cd ..

echo "‚úÖ –ê—Ä—Ö–∏–≤ —Å–æ–∑–¥–∞–Ω: photo_app_deploy.zip"
echo ""
echo "üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ Reg.ru:"
echo "1. –í–æ–π—Ç–∏ –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Reg.ru"
echo "2. –ü–µ—Ä–µ–π—Ç–∏ –≤ —Ä–∞–∑–¥–µ–ª '–•–æ—Å—Ç–∏–Ω–≥' ‚Üí '–§–∞–π–ª–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä'"
echo "3. –û—Ç–∫—Ä—ã—Ç—å –ø–∞–ø–∫—É public_html"
echo "4. –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã –∏–∑ public_html (–µ—Å–ª–∏ –µ—Å—Ç—å)"
echo "5. –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏ —Ä–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å photo_app_deploy.zip"
echo "6. –ò–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ FTP:"
echo "   - –•–æ—Å—Ç: ftp.$DOMAIN"
echo "   - –ü–∞–ø–∫–∞: public_html"
echo ""
echo "üîß –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏:"
echo "1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (Let's Encrypt)"
echo "2. –í–∫–ª—é—á–∏—Ç—å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ HTTPS –≤ .htaccess"
echo "3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å–∞–π—Ç–∞: https://$DOMAIN"
echo ""
echo "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:"
echo "   –†–∞–∑–º–µ—Ä –∞—Ä—Ö–∏–≤–∞: $(du -sh photo_app_deploy.zip | cut -f1)"
echo "   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤: $(find $TEMP_DIR -type f | wc -l)"

# –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –ø–∞–ø–∫–∏
rm -rf $TEMP_DIR

echo ""
echo "üéâ –ì–æ—Ç–æ–≤–æ! –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –Ω–∞ Reg.ru"

